---
title: Adding Error Reporting with Sentry
description: Guide to add Error Reporting with Sentry to the project
---
import { Steps } from '@astrojs/starlight/components';

You should add Sentry — or an open source alternative — to monitor errors in your project.

At Lonestone, we use both [Sentry](https://sentry.io/) and [Bugsink](https://www.bugsink.com/), which is a self-hosted Sentry alternative, compatible with the Sentry SDK.

:::note
This doc is mostly based on the [Sentry NestJS documentation](https://docs.nestjs.com/recipes/sentry), with some modifications to fit the Boilerstone project.
:::

<Steps>

1. ### Install the Sentry SDK in the API project

   ```bash
   cd apps/api
   pnpm add @sentry/nestjs
   ```

   <br/>

2. ### Add environment variables in the API project (both .env and .env.example)

   ```env
   SENTRY_DSN=https://<your-dsn>@sentry.io/<your-project>
   ```

   <br/>

3. ### Load the env in your env.config.ts file. Follow the same pattern as the other env.

    When using Sentry, it's a good practice to set a release name. This can be done in numerous ways, here is an example using the package.json version.

    ```typescript   title="src/config/env.config.ts"
        import { version } from '../../package.json'


        export const configValidationSchema = z.object({
        // ... other env variables ...
          VERSION: z.string().default(version),
          SENTRY_DSN: z.string(),
        })

        // .....

        export const config = {
            // ... other config variables ...
            version: configParsed.data.VERSION,
            sentry: {
                dsn: configParsed.data.SENTRY_DSN,
            },
        } as const
    ```

4. ### Create an `instrument.ts` file at the root of the API project

   ```typescript   title="src/instrument.ts"
    import * as Sentry from '@sentry/nestjs'
    import { config } from './config/env.config'

    // Ensure to call this before requiring any other modules!
    Sentry.init({
        dsn: config.sentry.dsn,
        environment: config.env,
        release: config.version,
    })
   ```

   <br/>

5. ### Load the Sentry module

   ```typescript   title="src/app.module.ts"
    /* eslint-disable perfectionist/sort-imports */

    // Import this first to initialize Sentry!
    import './instrument'

    // .. other imports //
    import { SentryGlobalFilter, SentryModule } from '@sentry/nestjs/setup'


    @Module({
    imports: [
        SentryModule.forRoot(), // add this line
        // .. other imports //
    ],
    controllers: [],
    providers: [
        // Add this provider to catch all errors
        {
            provide: APP_FILTER,
            useClass: SentryGlobalFilter,
        },
        // .. other providers //
    ],
    })
    export class AppModule {}

   ```

</Steps>